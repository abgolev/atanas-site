<!DOCTYPE>
<!--
	Created by Atanas Golev.
-->

<HTML>
<TITLE>Disconnections</TITLE>
<HEAD>
<STYLE>

table#Words {
	width: 100%;
	cursor: default;
	table-layout: fixed;
}

table#Words th, td {
	border: 0.5px solid black;
}

table#Words td {
	position: relative;
	text-align: center;
	vertical-align: middle;
	font-size: 2.5em;
	width: 24%;
	display: inline-block;
}

table#Words .content {
	aspect-ratio: 1/1;
}

table#Words center {
	margin-left: auto;
	margin-right: auto;
}

table#Mistakes{
	width: 70%;
	cursor: default;
	font-size: 2em;
	text-align: center;
}

table#Mistakes center {
	margin-left: auto;
	margin-right: auto;
}

h1 {
	font-size: 4em;
	width: 100%;
	text-align: center;
}

#wrapper {
	width:100%;
	text-align: center;
}
	
.button {
	border: none;
	color: white;
	padding: 16px 16px;
	text-align: center;
	text-decoration: none;
	font-size: 32px;
	margin-left: auto;
	margin-right: auto;
	cursor: pointer;
	background-color: #04AA6D;
	display: inline-block;
}
.button:disabled {
	opacity: 0.33;
	pointer-events: none;
}

td {
  vertical-align: middle;
}

</STYLE>

<SCRIPT>
var day = 0;
var guessesLeft = 4;
var wordsSelected = 0;
var isSelected = false;
var defaultImagePath = "images/";
var totalGames = 0; 
var canSubmit = false;
var rowsCleared = 0;

var wordMatrix = [
	["ONE", "TWO", "THREE", "FOUR"],
	["FIVE", "SIX", "SEVEN", "EIGHT"],
	["NINE", "TEN", "ELEVEN", "TWELVE"],
	["THIRTEEN", "FOURTEEN", "FIFTEEN", "SIXTEEN"]
]
	
var selectionMatrix = [
	[false, false, false, false],
	[false, false, false, false],
	[false, false, false, false],
	[false, false, false, false]
]
	
var associations = [
	"Drugs",
	"Palindromes",
	"Mother",
	"Cheetah"
]
	
function load() {
	alert("Welcome to Disconnections");
	//enables clicks and sets words
	for(i = 0 ; i < 4; i++){	
		for(j = 0; j < 4; j++){
			whichWord = document.getElementById("word"+i+j);
			whichWord.innerHTML = wordMatrix[i][j];
			whichWord.addEventListener("click", wordClick);
		}
	}
	document.getElementById("Submit").disabled = true;
	document.getElementById("ClearAll").disabled = true;
	document.getElementById("Shuffle").addEventListener("click", clickShuffle);
	
}

function wordClick(){
	var cellRow = this.id.substring(4,5);
	var cellCol = this.id.substring(5,6);
	var cellId = "word" + cellRow + cellCol;
	if(selectionMatrix[cellRow][cellCol]==false){
		if(wordsSelected == 4)
			return;
		document.getElementById(cellId).style.backgroundColor = "#98DEE6";
		selectionMatrix[cellRow][cellCol] = true;
		wordsSelected++;
		console.log("Words selected: " + wordsSelected);
		if(wordsSelected == 4)
			canSubmit = true;
		canSubmit = false;
	}
	else{
		document.getElementById(cellId).style.backgroundColor = "#FFFFFF";
		selectionMatrix[cellRow][cellCol] = false;
		wordsSelected--;
		console.log("Words selected: " + wordsSelected);
		canSubmit = false;
	}

	//set buttons to enabled/disabled
	if(wordsSelected > 0){
		document.getElementById("ClearAll").disabled = false;
		document.getElementById("ClearAll").addEventListener("click", clearAll);
	}
	else{
		document.getElementById("ClearAll").disabled = true;
		document.getElementById("ClearAll").removeEventListener("click", clearAll);
	}
	
	if(wordsSelected == 4){
		document.getElementById("Submit").disabled = false;
		document.getElementById("Submit").addEventListener("click", submitWords);
	}
	else{
		document.getElementById("Submit").disabled = true;
		document.getElementById("Submit").removeEventListener("click", submitWords);
	}
		
}

function rowCleared(){
	console.log("row cleared woots");
}

function submitWords(){
	console.log("we submitted woots");
	//we can now go through the boolean matrix looking for num true / false
}

function clickShuffle(){
	console.log("we shuffled woots");
}

function clearAll(){
	wordsSelected=0;
	for(i = 0 ; i < 4; i++){	
		for(j = 0; j < 4; j++){
			document.getElementById(cellId).style.backgroundColor = "#FFFFFF";
			whichWord = document.getElementById("word"+i+j);
			whichWord.innerHTML = wordMatrix[i][j];
			whichWord.addEventListener("click", wordClick);
		}
	}
	console.log("we cleared everything woots");
}

//Starts up a new game of meowtzee when the New Game button is clicked
function ModNewGame() {
	newgame = document.getElementById("NewGame");
	newgame.onclick = StartGame(newgame);
	newgame.style.color="black";
}

function ModNewGame2(){
	newgame2 = document.getElementById("NewGamePapaG");
	newgame2.onclick = StartGame2(newgame2);
	newgame2.style.color="black";
}

//Resets all the values neccessary to start a new game... 
function StartGame() {
	updateWins();
	ResetScores();
	ResetButtons();
	resetDiceStartGame();
	currentTurn = 0;
	currentRoll = 0;
	computerTurn = false;
}

//Used for inverted dice selection
function StartGame2() {
	newgame.removeEventListener("click",ModNewGame);	//does not allow to start again midgame
	newgame2.removeEventListener("click",ModNewGame);	//does not allow to start again midgame
	newgame.innerHTML = "";
	newgame2.innerHTML = "";
	papaGolevStyle = true;
	updateWins();
	ResetScores();
	ResetButtons();
	resetDiceStartGame();
	currentTurn = 0;
	currentRoll = 0;
	computerTurn = false;
}

function StartGameTester() {
	computerTurn=true;	
	while(totalGames<TESTERGAMES){
		ResetScores();
		ResetButtonsTester();
		currentTurn = 0;
		currentRoll = 0;
		RollTester();
		setScoreTester();		//Sets all scores
		compTesterScores[compTesterScores.length] = cScore[cScore.length-1]; //adds new scores to array
		totalGames += 1;	//Updates number of games played
	}
	document.getElementById("Roll").onclick=noClick;	//disable dice roll after previous game ends
	document.getElementById("Roll").innerHTML="Roll";
	document.getElementById("Roll").style.color = "black";
	endTest();	//prints output
}

//Resets player scores
function ResetScores() {
	var slot = "";
	var maxSlots = pScore.length;
	var i;
	for(i=0; i<pScore.length; i++) {
		pScore[i] = 0;
		cScore[i] = 0;
	}
	//cIsAvailable = [false, false, false, false, false, false, false, false, false, false, false, false, true, false, false, false];
	cIsAvailable = [true, true, true, true, true, true, false, false, true, true, true, true, true, true, true, false];
	pIsAvailable = [true, true, true, true, true, true, false, false, true, true, true, true, true, true, true, false];

}

//Resets all the values so none are held and all are zero
function resetDice() {
	var i;
	for (i=0 ; i<diceValues.length; i++) {	//for all dice
		diceValues[i] = 0;			//sets their values to 0
		if(papaGolevStyle)
			heldValues[i]=true;
		else
			heldValues[i]=false;			//sets them to not held
		whichDie = document.getElementById("d"+i);
		//whichDie.src = defaultPath+"die0.png";	//sets them to default blank dice
		whichDie.onclick = toggleHold;		//enables toggles
	}
	for (i=0; i<6; i++){
		counter[i]=0;
	}	
}

//Resets all the values so none are held and all are zero
function resetDiceTester() {
	var i;
	for (i=0 ; i<diceValues.length; i++) {	//for all dice
		diceValues[i] = 0;			//sets their values to 0
		heldValues[i] = false;			//sets them to not held
	}
	for (i=0; i<6; i++){
		counter[i]=0;
	}	
}

function resetDiceStartGame() {
	var i;
	for (i = 0 ; i < diceValues.length; i++) {	//for all dice
		whichDie = document.getElementById("d"+i);
		whichDie.src = defaultPath+"die0.png";	//sets them to default blank dice
	}
}

//Once a new game starts, we reset the Player scoreboards and make it clickable again
function ResetButtons() {
	resetRoll();	//resets the Roll button
	resetDice();	//resets the Dice
	
	var i;
	for(i = 0 ; i < 16; i++){	//blanks all scorecard entries and sets boundaries to black
		document.getElementById("p"+i).innerHTML="";
		document.getElementById("p"+i).style.borderColor = "black";	
		document.getElementById("c"+i).innerHTML="";
		document.getElementById("c"+i).style.borderColor = "black";	
	}

	for(i = 0 ; i < 6; i++){	//enables clicks
		whichScore = document.getElementById("p"+i);
		whichScore.addEventListener("click", setScore);
	}

	for(i = 8; i < 15; i++){
		whichScore = document.getElementById("p"+i);
		whichScore.addEventListener("click", setScore);		
	}

	//Reset score boxies
	var j;
	for(j=0; j<16; j++){
		document.getElementById("c"+j).style.backgroundColor = "FFFFFF";
		document.getElementById("p"+j).style.backgroundColor = "FFFFFF";
	}
}

//used in testing mode
function ResetButtonsTester() {
	resetRoll();	//resets the Roll button
	resetDice();	//resets the Dice
}

//Resets the Roll Button
function resetRoll() {
	newturn = document.getElementById("Roll");
	newturn.style.color = "blue";			//changes color to blue
	newturn.onclick = Roll;				//click causes to Roll
	newturn.innerHTML = "Roll";
	currentRoll = 0;				//sets back to 0 rolls total this round
	cGoodNumber = -1;
	cChoice = -1;
}

//Resets the Roll Button
function resetRollTester() {
	currentRoll = 0;				//sets back to 0 rolls total this round
	cGoodNumber = -1;
	cChoice = -1;
}

//Messages pop up when you click on each box name
function ShowMessage(){
	if(this.id=="b0")
		alert("ONES: You get 1 point for each 1 die you have.");
	else if(this.id=="b1")
		alert("TWOS: You get 2 points for each 2 die you have.");
	else if(this.id=="b2")
		alert("THREES: You get 3 points for each 3 die you have.");
	else if(this.id=="b3")
		alert("FOURS: You get 4 points for each 4 die you have.");
	else if(this.id=="b4")
		alert("FIVES: You get 5 points for each 5 die you have.");
	else if(this.id=="b5")
		alert("SIXES: You get 6 points for each 6 die you have.");
	else if(this.id=="b6")
		alert("SUM: The sum of your 6 Upper Section boxes. It gets calculated after your final roll. If the sum is 63 points or over, you get 35 bonus points.");
	else if(this.id=="b7")
		alert("BONUS: If the sum of your upper 6 Upper Section boxes is 63 points or over, you get 35 bonus points.");
	else if(this.id=="b8")
		alert("3 OF A KIND: You must have at least three dice of the same kind. The point total you get is the sum of all five dice.");
	else if(this.id=="b9")
		alert("4 OF A KIND: You must have at least four dice of the same kind. The point total you get is the sum of all five dice.");
	else if(this.id=="b10")
		alert("FULL HOUSE: You must have three dice of one kind and two dice of another kind. You get 25 points.");
	else if(this.id=="b11")
		alert("LITTLE STRAIGHT: You must have a straight of four or more values in a row (for example, 1 2 3 4). They don't have to be in order. You get 30 points.");
	else if(this.id=="b12")
		alert("BIG STRAIGHT: You must have a straight of five values in a row (for example, 2 3 4 5 6). They don't have to be in order. You get 40 points.");
	else if(this.id=="b13")
		alert("CHANCE: You can pick this at any time to get as many points as the sum of all the dice.")
	else if(this.id=="b14")
		alert("MEOWTZEE: You must have five dice of the same kind. If this is your first Meowtzee of the game, you get 50 points. However, if you already filled in the Meowtzee box or this is your second Meowtzee, there are two variations: \n \n 1. If you have a 0 score in Meowtzee: you get to use this Meowtzee as a Joker. This means that you can pick any of the Lower Section categories (3 of a Kind, 4 of a Kind, Full House, Little Straight, Big Straight) for their full point total. You get no additional Meowtzee Bonus. \n \n 2. If you have 50 or more in your Meotwzee box: You get an automatic 100 point Meowtzee bonus. However, if your upper box with the Meowtzee dice number is not currently filled, you must choose that category (no worries, Prof. Meowsky takes care of that for you). But if that particular Upper Section box is already filled, you can use the Meowtzee as a Joker, clicking any Lower Section category for the full point total. ");
	else if(this.id=="b15")
		alert("TOTAL: Your total points for the game.");
	//Helpful hints
	else if(this.id=="prof"){
		hint = getRandomInt(1,7);

		if(hint==1)
			alert("It's a good idea to go for the Upper Section Bonus. You have to have a Sum of 63 from the Upper Section to achieve this. This means, on average, 3 dice in each of the ONES through SIXES categories.")
		else if(hint==2)
			alert("If you end up with bad dice, sometimes it's a good idea to take a 0 in an unimportant box like Ones or a difficult box such as Four of a Kind or Large Straight.");
		else if(hint==3)
			alert("You can select a category even after your first roll; you don't have to wait until the last roll.");
		else if(hint==4)
			alert("If you get a bad dice roll, you can choose to reroll all five dice instead of holding anything.");
		else if(hint==5)
			alert("Four of a Kind is statistically the category with one of the lowest expected values because of the difficulty of achieving it as well as a max 30 point total.");
		else if(hint==6)
			alert("The probability of getting a Meowtzee on any given roll is 0.077%.");
		else if(hint==7)
			alert("Upper Section refers to the categories of Ones through Sixes. Lower Section refers to the categories from 3 of a Kind through Meowtzee.");

	}
}

function sleep(ms){
	return new Promise(resolve => setTimeout(resolve, ms));
}

//used in testing mode
function RollTester(){
	currentRoll += 1;
	rollDiceTester(currentRoll);
	if (currentRoll >= MAXROLLS) {
		return;
	} 
}

//rolling the dice
function Roll() {
	if(debugHeld()==5 && !papaGolevStyle){	//if all six dice are held
		alert("Meow you holding all 5 dice? U meowght want to reconsider?");
	}
	else{
		var rollB = document.getElementById("Roll");
		// roll dice, update images, modify Roll button;
		currentRoll += 1;
		rollDice();
		rollB.innerHTML = "Roll("+currentRoll+")";
		rollB.nodeValue = currentRoll;
		if (currentRoll >= MAXROLLS) {
			rollB.style.color = "black";
			rollB.onclick = noClick;
			return;
		} 
	}
}

//sends helpful messages to the users
function newMessage(aMessage) {
	document.getElementById("gameMessage").innerHTML = aMessage;
}

//used to disable rolling if max rolls was reached
function noClick() {
//	console.log("No more rolls!");
}

async function rollDice() {
	var rolly = 0;		//random dice roll
	var imagePath="";	//new dice image to update

	var v;
	for (v=0; v<5; v++){
		if(heldValues[v]==false){
			document.getElementById("d"+v).src = defaultPath+"die0.png";
		}	
	}

	await sleep (500);	

	var i;
	for (i=0 ; i<5; i++) {	//goes through all dice
		if(heldValues[i]==false || (currentRoll==1 && papaGolevStyle)){		//rolls all not held dice
			rolly = getRandomInt(1,6);	//random number from 1-6
			diceValues[i]=rolly;		//sets value to 
			//imagePath=defaultPath + rolly + ".png";		//updates dice on screen
			imagePath=defaultPath + "die"+ rolly+ ".png";		//updates dice on screen
			document.getElementById("d"+i).src = imagePath;
			if(papaGolevStyle)
				heldValues[i]=true;
		}
	}
	
	//console.log("meow");
	var potentialScore=0;
	var j;
	for(j=0; j<15; j++){
		potentialScore = "" + computeScore(j);
		var output = potentialScore.fontcolor("SteelBlue");
		if(pIsAvailable[j] && computerTurn==false)
			document.getElementById("p"+j).innerHTML = output; //changes HTML to reflect potential score
		else if(cIsAvailable[j] && computerTurn==true)
			document.getElementById("c"+j).innerHTML = output; //changes HTML to reflect potential score
	}
		
	if(isSecondPlayerYahtzee() && computerTurn==false){
		alert("Second Meowtzee, congrats! If your Meowtzee score is not 0 and the upper level box with the Meowtzee dice number you got is still available, that will be filled in automatically, no matter what you selected. Otherwise, you can select any of the Lower Section categories, for full points.")
	}


}

//used in testing mode
function rollDiceTester() {
	var rolly = 0;		//random dice roll

	var i;
	for (i=0 ; i<5; i++) {	//goes through all dice
		if(heldValues[i]==false){		//rolls all not held dice
			rolly = getRandomInt(1,6);	//random number from 1-6
			diceValues[i]=rolly;		//sets value to 
			imagePath=defaultPath + "die"+ rolly+ ".png";		//updates dice on screen
			document.getElementById("d"+i).src = imagePath;
		}
	}

}

function getRandomInt(min, max) {
	var randNum = 0;
	min = Math.ceil(min);
	max = Math.floor(max);
	randNum = Math.floor(Math.random()*(max-min+1))+min;
	return randNum;
}

//returns the sum of the dice in each hand
function sumDice(){
	var sum=0;
	var s;
	for(s=0; s<5; s++){
		sum+=diceValues[s];
	}
	return sum;
}

//displays the proper scores in each box and sets score whenever user clicks
async function setScore() {
	if(currentRoll!=0){		//makes sure that the dice have been rolled before selection
		currentTurn+=1;		//counts number of boxes selected
		document.getElementById(this.id).removeEventListener("click",setScore);	//disables click for that box
		document.getElementById(this.id).style.borderColor = "green";	//changes boundary to green
	
		var slot = this.id.substring(1,3);

		if(isSecondPlayerYahtzee()){		//if second yahtzee, special process
			if(pScore[14]>0){		//has to fill out the upper level box no matter what is clicked
				pScore[14]+=100;
				document.getElementById("p14").innerHTML = pScore[14]; //changes HTML to reflect score
				pScore[15]+=100;
				if(pIsAvailable[diceValues[0]-1])
					slot = diceValues[0]-1;
			}
		}

		pIsAvailable[slot]=false;
		var score = computeScore(slot); //compute score
		pScore[slot]=score;
		document.getElementById("p"+slot).innerHTML = score; //changes HTML to reflect score
		document.getElementById("p"+slot).style.backgroundColor = "#7FFFD4";
		pScore[15]+=score;
		document.getElementById("p15").innerHTML = pScore[15];
		if(slot<6)
			pScore[6]+=score;

		//Reset score boxies
		var j;
		for(j=0; j<15; j++){
			if(pIsAvailable[j]){
				document.getElementById("p"+j).innerHTML = ""; //changes HTML to reflect potential score
			}
		}

		resetDice();
		resetRoll();
		doComputer(currentTurn);
		await sleep(10500);

		if(currentTurn==maxTurns){	//once all 7 boxes are checked, ends game
			computeBonus();		//computes bonus
			endGame();		//end game calculations
			currentRoll=4;
		}
	}
}

//AI for computer turn in testing mode
function doComputerTester(whichTurn) {
	computerTurn=true;
	currentRoll = 0;
	
	//console.log("Availablility:"+cIsAvailable);
	var holdDecision;
	while(currentRoll < MAXROLLS && cChoice==-1){
		rollDiceTester(currentRoll);
		currentRoll += 1;
		//console.log("PC Roll: "+currentRoll);
		//console.log("Dice: "+diceValues);	
		diceCounter();
		holdDecision = makeHoldDecision();
		doComputerToggles(holdDecision);
	} 

	if(cChoice==-1){
		damageControlChoice();
	}

	//console.log("PC Choice: " + cChoice);

	if(!cIsAvailable[cChoice]){
		console.log("Bad thing. Choice alreeady selected: "+cChoice);
	}

	cIsAvailable[cChoice]=false;
	var whichPlace = "c"+cChoice;
	var score = computeScore(cChoice);
	//console.log("cChoice: " + cChoice);
	//console.log("score: " + score);
	cScore[cChoice]=score;
	cTotalScore[cChoice]+=score;
	cScore[15]+=score;
	if(cChoice<6){
		cScore[6]+=score;
		cTotalScore[6]+=score;	
	}

	computerTurn=false;

	resetDiceTester();
	resetRollTester();
	RollTester();
	setScoreTester();
}

//toggles dice hold for the computer
function doComputerToggles(decisionArray){
	d0.src = doToggle("d0", d0.src, decisionArray[0]);
	d1.src = doToggle("d1", d1.src, decisionArray[1]);
	d2.src = doToggle("d2", d2.src, decisionArray[2]);
	d3.src = doToggle("d3", d3.src, decisionArray[3]);
	d4.src = doToggle("d4", d4.src, decisionArray[4]);
}

function updateWins() {

	var cAvg = 0;
	var pAvg = 0;
	var cPercent = 0;
	var pPercent = 0;

	if (totalGames > 0) {
		cPercent = cWins/totalGames*100;
		pPercent = pWins/totalGames*100;
		cAvg = computerTotalScore/totalGames;
		pAvg = playerTotalScore/totalGames;
	}

	document.getElementById("cWins").innerHTML = cWins;
	document.getElementById("pWins").innerHTML = pWins;
	document.getElementById("cAvg").innerHTML = cAvg;
	document.getElementById("pAvg").innerHTML = pAvg;
	document.getElementById("cHigh").innerHTML = cHighScore;
	document.getElementById("pHigh").innerHTML = pHighScore;
}

</SCRIPT>
	
</HEAD>
<h1>DISCONNECTIONS</h1>
<BODY ONLOAD="load()">

<TABLE ID="Words">
<TR>
	<TD ID="word00" div class="content"> </div></TD>
	<TD ID="word01" div class="content"> </div></TD>
	<TD ID="word02" div class="content"> </div></TD>
	<TD ID="word03" div class="content"> </div></TD>
</TR>
<TR>
	<TD ID="word10" div class="content"> </div></TD>
	<TD ID="word11" div class="content"> </div></TD>
	<TD ID="word12" div class="content"> </div></TD>
	<TD ID="word13" div class="content"> </div></TD>
</TR>
<TR>
	<TD ID="word20" div class="content"> </div></TD>
	<TD ID="word21" div class="content"> </div></TD>
	<TD ID="word22" div class="content"> </div></TD>
	<TD ID="word23" div class="content"> </div></TD>
</TR>
<TR>
	<TD ID="word30" div class="content"> </div></TD>
	<TD ID="word31" div class="content"> </div></TD>
	<TD ID="word32" div class="content"> </div></TD>
	<TD ID="word33" div class="content"> </div></TD>
</TR>
</TABLE>

<br>

<TABLE ID="Mistakes">
<TR>
	<TH>Mistakes remaining: </TH>
	<TD ID="mistake0">1 </TD>
	<TD ID="mistake1">2 </TD>
	<TD ID="mistake2">3 </TD>
	<TD ID="mistake3">4 </TD>
</TR>
</TABLE>

<br>
<div id="wrapper">
	<div class="button"><button class="button button" id="Submit">Submit</button></div>
	<div class="button"><button class="button button" id="ClearAll">Deselect all</button></div>
	<div class="button"><button class="button button" id="Shuffle">Shuffle</button></div>
</div>
	
</BODY>
</HTML>
